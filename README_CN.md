# K8S æ¯æ—¥çŠ¶æ€æ‘˜è¦ CLI

[English](./README.md) | ä¸­æ–‡ | [å¿«é€Ÿå¼€å§‹](./QUICK_START.md)

ä¸€ä¸ªåŸºäº TypeScript å¼€å‘çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ”¶é›†å’Œæ±‡æ€» Kubernetes é›†ç¾¤çš„æ¯æ—¥è¿è¡ŒçŠ¶æ€ã€‚æ­¤å·¥å…·é€šè¿‡åˆ†æ Pod é‡å¯ã€Job å¤±è´¥å’Œè­¦å‘Šäº‹ä»¶ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿäº†è§£ K8s é›†ç¾¤çš„å¥åº·çŠ¶å†µã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **Pod çŠ¶æ€ç›‘æ§** ğŸ“Š
  - è¿½è¸ª Pod é‡å¯æ¬¡æ•°å’Œé‡å¯åŸå› ï¼ˆOOMKilledã€CrashLoopBackOff ç­‰ï¼‰
  - ç›‘æ§å¼‚å¸¸çŠ¶æ€çš„ Podï¼ˆPendingã€Failedã€Unknownï¼‰
  - æ˜¾ç¤ºé‡å¯æ—¶é—´å’Œæ‰€å±å‘½åç©ºé—´
  
- **Job å¥åº·åˆ†æ** ğŸ”
  - ç»Ÿè®¡æˆåŠŸ/å¤±è´¥çš„ Job æ•°é‡
  - è¯¦ç»†æ˜¾ç¤ºå¤±è´¥ Job çš„å¤±è´¥åŸå› å’Œæ‰§è¡Œæ—¶é•¿
  - æ”¯æŒ CronJob æ‰§è¡ŒçŠ¶æ€åˆ†æ
  
- **äº‹ä»¶èšåˆåˆ†æ** âš ï¸
  - æ”¶é›†å’Œæ±‡æ€» Warning çº§åˆ«äº‹ä»¶
  - æŒ‰äº‹ä»¶ç±»å‹åˆ†ç»„ç»Ÿè®¡
  - æ˜¾ç¤ºäº‹ä»¶å‘ç”Ÿé¢‘ç‡å’Œæœ€è¿‘å‘ç”Ÿæ—¶é—´
  
- **å¤šç§è¾“å‡ºæ ¼å¼** ğŸ“„
  - **ç»ˆç«¯è¾“å‡º**ï¼šå½©è‰²è¡¨æ ¼ï¼Œç›´è§‚æ˜“è¯»
  - **JSON æ ¼å¼**ï¼šä¾¿äºç¨‹åºåŒ–å¤„ç†å’Œé›†æˆ
  - **Markdown æ ¼å¼**ï¼šé€‚åˆç”ŸæˆæŠ¥å‘Šæ–‡æ¡£
  
- **çµæ´»é…ç½®é€‰é¡¹** âš™ï¸
  - è‡ªå®šä¹‰æ—¶é—´èŒƒå›´ï¼ˆé»˜è®¤ 24 å°æ—¶ï¼‰
  - å‘½åç©ºé—´è¿‡æ»¤
  - è‡ªå®šä¹‰ kubeconfig è·¯å¾„
  - æ”¯æŒè¾“å‡ºåˆ°æ–‡ä»¶

## ğŸ› ï¸ å®‰è£…è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- Node.js 16+ å’Œ npm
- å¯è®¿é—®çš„ Kubernetes é›†ç¾¤
- æœ‰æ•ˆçš„ kubeconfig æ–‡ä»¶
- é€‚å½“çš„ RBAC æƒé™

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
cd k8s-summary

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ä½¿ç”¨

```bash
# åˆ†ææœ€è¿‘ 24 å°æ—¶ï¼ˆé»˜è®¤ï¼‰
npm run summary

# æˆ–è€…ä½¿ç”¨æ„å»ºåçš„äºŒè¿›åˆ¶æ–‡ä»¶
./dist/index.js

# æˆ–è€…ç›´æ¥è¿è¡Œå¼€å‘æ¨¡å¼
npm run dev
```

### é«˜çº§é€‰é¡¹

```bash
# æŒ‡å®šæ—¶é—´èŒƒå›´
npm run dev -- --hours 48

# åˆ†æç‰¹å®šå‘½åç©ºé—´
npm run dev -- --namespace production

# è¾“å‡ºä¸º JSON æ ¼å¼
npm run dev -- --format json --output summary.json

# è¾“å‡ºä¸º Markdown æ ¼å¼
npm run dev -- --format markdown --output report.md

# ä½¿ç”¨è‡ªå®šä¹‰ kubeconfig
npm run dev -- --kubeconfig ~/.kube/config-prod

# ç»„åˆå¤šä¸ªé€‰é¡¹
npm run dev -- --hours 12 --namespace default --format markdown --output daily-report.md
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|------|------|--------|------|
| `-h, --hours` | å‘å‰è¿½æº¯çš„å°æ—¶æ•° | 24 | `--hours 48` |
| `-n, --namespace` | æŒ‡å®šè¦åˆ†æçš„å‘½åç©ºé—´ | å…¨éƒ¨ | `--namespace production` |
| `-f, --format` | è¾“å‡ºæ ¼å¼ï¼šconsole/json/markdown | console | `--format json` |
| `-o, --output` | è¾“å‡ºæ–‡ä»¶è·¯å¾„ | æ— ï¼ˆç»ˆç«¯è¾“å‡ºï¼‰ | `--output report.md` |
| `-k, --kubeconfig` | kubeconfig æ–‡ä»¶è·¯å¾„ | é»˜è®¤ä½ç½® | `--kubeconfig ~/.kube/config` |

## ğŸ“‹ è¾“å‡ºç¤ºä¾‹

### ç»ˆç«¯æ ¼å¼è¾“å‡º
```
=== K8S Daily Summary Report ===
æ—¶é—´èŒƒå›´: 2024-03-20 00:00 - 2024-03-21 00:00

## Pod çŠ¶æ€æ‘˜è¦
- æ€» Pod æ•°é‡: 150
- é‡å¯çš„ Pod: 5
- å¼‚å¸¸çŠ¶æ€ Pod: 2

Pod é‡å¯è¯¦æƒ…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pod åç§°                      â”‚ å‘½åç©ºé—´            â”‚ é‡å¯æ¬¡æ•°  â”‚ é‡å¯åŸå›               â”‚ æœ€åé‡å¯æ—¶é—´             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ app-backend-xyz              â”‚ default            â”‚ 3        â”‚ OOMKilled            â”‚ 2024/3/20 10:30:00     â”‚
â”‚ worker-abc                   â”‚ jobs               â”‚ 2        â”‚ Error                â”‚ 2024/3/20 09:15:00     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## Job å¥åº·çŠ¶å†µæ‘˜è¦
- æˆåŠŸçš„ Job: 45
- å¤±è´¥çš„ Job: 2
- æ´»è·ƒçš„ Job: 3

å¤±è´¥çš„ Job è¯¦æƒ…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job åç§°                      â”‚ å‘½åç©ºé—´            â”‚ æ‰§è¡Œæ—¶é•¿  â”‚ å¤±è´¥åŸå›                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ data-sync-job                â”‚ default            â”‚ 15m 30s  â”‚ BackoffLimitExceeded                 â”‚
â”‚ backup-job                   â”‚ backup             â”‚ 1h 5m    â”‚ DeadlineExceeded                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## äº‹ä»¶æ‘˜è¦
- è­¦å‘Šäº‹ä»¶: 12
- æ€»äº‹ä»¶æ•°: 156

## å…³é”®æ´å¯Ÿ
â€¢ å‘ç° 5 ä¸ª Pod é‡å¯ï¼ˆæ€»è®¡ 8 æ¬¡é‡å¯ï¼‰
â€¢ 1 ä¸ª Pod å›  OOMKilled é‡å¯ - å»ºè®®å¢åŠ å†…å­˜é™åˆ¶
â€¢ æœ€å¸¸è§çš„è­¦å‘Š: "BackOff" (5 æ¬¡å‡ºç°)
```

### JSON æ ¼å¼è¾“å‡º
```json
{
  "summary": {
    "timeRange": {
      "start": "2024-03-20T00:00:00.000Z",
      "end": "2024-03-21T00:00:00.000Z"
    },
    "pods": {
      "total": 150,
      "restarted": [
        {
          "name": "app-backend-xyz",
          "namespace": "default",
          "restartCount": 3,
          "reason": "OOMKilled",
          "lastRestartTime": "2024-03-20T10:30:00.000Z"
        }
      ],
      "abnormal": []
    },
    "jobs": {
      "successful": 45,
      "failed": [],
      "active": 3
    },
    "events": {
      "warnings": [],
      "total": 156
    }
  },
  "insights": [
    "å‘ç° 5 ä¸ª Pod é‡å¯ï¼ˆæ€»è®¡ 8 æ¬¡é‡å¯ï¼‰",
    "1 ä¸ª Pod å›  OOMKilled é‡å¯ - å»ºè®®å¢åŠ å†…å­˜é™åˆ¶"
  ]
}
```

## ğŸ” Kubernetes æƒé™è¦æ±‚

æ‚¨çš„æœåŠ¡è´¦æˆ·æˆ–ç”¨æˆ·éœ€è¦ä»¥ä¸‹æƒé™ï¼š

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: k8s-summary-reader
rules:
- apiGroups: [""]
  resources: ["pods", "events", "namespaces"]
  verbs: ["get", "list"]
- apiGroups: ["batch"]
  resources: ["jobs", "cronjobs"]
  verbs: ["get", "list"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list"]
```

åº”ç”¨æƒé™ï¼š
```bash
kubectl apply -f rbac.yaml
kubectl create clusterrolebinding k8s-summary-binding \
  --clusterrole=k8s-summary-reader \
  --user=<your-username>
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
k8s-summary/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # CLI å…¥å£ç‚¹
â”‚   â”œâ”€â”€ types/                # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ collectors/           # æ•°æ®æ”¶é›†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ pod.ts           # Pod çŠ¶æ€æ”¶é›†å™¨
â”‚   â”‚   â”œâ”€â”€ job.ts           # Job å¥åº·ç›‘æ§å™¨
â”‚   â”‚   â””â”€â”€ event.ts         # äº‹ä»¶æ”¶é›†å™¨
â”‚   â”œâ”€â”€ analyzers/           # æ•°æ®åˆ†ææ¨¡å—
â”‚   â”‚   â””â”€â”€ summary.ts       # æ‘˜è¦åˆ†æå™¨
â”‚   â”œâ”€â”€ formatters/          # è¾“å‡ºæ ¼å¼åŒ–å™¨
â”‚   â”‚   â”œâ”€â”€ console.ts       # ç»ˆç«¯å½©è‰²è¾“å‡º
â”‚   â”‚   â””â”€â”€ markdown.ts      # Markdown æ ¼å¼è¾“å‡º
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ k8s-client.ts   # Kubernetes å®¢æˆ·ç«¯å°è£…
â”œâ”€â”€ dist/                   # ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶
â”œâ”€â”€ scripts/               # è¾…åŠ©è„šæœ¬
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸ”§ å¼€å‘æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å¼€å‘æ¨¡å¼è¿è¡Œ
npm run dev

# æ„å»ºé¡¹ç›®
npm run build

# è¿è¡Œæ„å»ºåçš„ç‰ˆæœ¬
npm start

# æµ‹è¯•é¡¹ç›®ç»“æ„
node scripts/test-structure.js
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

1. **æ•°æ®æ”¶é›†å™¨ (Collectors)**
   - `PodCollector`: æ”¶é›† Pod é‡å¯å’Œå¼‚å¸¸çŠ¶æ€
   - `JobCollector`: ç›‘æ§ Job å’Œ CronJob å¥åº·çŠ¶å†µ
   - `EventCollector`: èšåˆé›†ç¾¤äº‹ä»¶

2. **æ•°æ®åˆ†æå™¨ (Analyzers)**
   - `SummaryAnalyzer`: ç”Ÿæˆç»¼åˆæ‘˜è¦å’Œæ™ºèƒ½æ´å¯Ÿ

3. **æ ¼å¼åŒ–å™¨ (Formatters)**
   - `ConsoleFormatter`: ç”Ÿæˆå½©è‰²ç»ˆç«¯è¾“å‡º
   - `MarkdownFormatter`: ç”Ÿæˆ Markdown æŠ¥å‘Š

## â— æ•…éšœæ’é™¤

### è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥é›†ç¾¤è¿æ¥
kubectl cluster-info

# éªŒè¯ kubeconfig
kubectl config current-context

# æµ‹è¯•æƒé™
kubectl auth can-i list pods --all-namespaces
```

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| `ECONNREFUSED` | æ— æ³•è¿æ¥åˆ°é›†ç¾¤ | æ£€æŸ¥ç½‘ç»œå’Œ kubeconfig |
| `Forbidden` | æƒé™ä¸è¶³ | é…ç½®æ­£ç¡®çš„ RBAC æƒé™ |
| `No data returned` | æ—¶é—´èŒƒå›´å†…æ— æ•°æ® | è°ƒæ•´æ—¶é—´èŒƒå›´æˆ–æ£€æŸ¥é›†ç¾¤æ´»åŠ¨ |
| `Namespace not found` | æŒ‡å®šçš„å‘½åç©ºé—´ä¸å­˜åœ¨ | ä½¿ç”¨ `kubectl get ns` ç¡®è®¤å‘½åç©ºé—´ |

### è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
DEBUG=k8s-summary npm run dev

# æµ‹è¯•ç‰¹å®šç»„ä»¶
npm run dev -- --namespace kube-system --hours 1
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. æ¯æ—¥å¥åº·æ£€æŸ¥
```bash
# ç”Ÿæˆæ¯æ—¥æŠ¥å‘Š
npm run dev -- --format markdown --output "reports/daily-$(date +%Y%m%d).md"
```

### 2. æ•…éšœæ’æŸ¥
```bash
# åˆ†ææœ€è¿‘ 2 å°æ—¶çš„é—®é¢˜
npm run dev -- --hours 2 --namespace production
```

### 3. å®šæœŸç›‘æ§
```bash
# é›†æˆåˆ° cron ä½œä¸š
0 9 * * * cd /path/to/k8s-summary && npm run dev -- --format json --output /var/log/k8s-summary.json
```

### 4. CI/CD é›†æˆ
```bash
# åœ¨éƒ¨ç½²åæ£€æŸ¥é›†ç¾¤çŠ¶æ€
npm run dev -- --hours 1 --format json | jq '.summary.pods.restarted | length'
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹: `git commit -m 'Add amazing feature'`
4. æ¨é€åˆ°åˆ†æ”¯: `git push origin feature/amazing-feature`
5. åˆ›å»º Pull Request

### å¼€å‘è§„èŒƒ
- ä½¿ç”¨ TypeScript è¿›è¡Œç±»å‹å®‰å…¨å¼€å‘
- éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼
- æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†
- ä¸ºæ–°åŠŸèƒ½ç¼–å†™æµ‹è¯•

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ è‡´è°¢

- [Kubernetes JavaScript Client](https://github.com/kubernetes-client/javascript)
- [Commander.js](https://github.com/tj/commander.js)
- [cli-table3](https://github.com/cli-table/cli-table3)
- [Chalk](https://github.com/chalk/chalk)

---

å¦‚æœè¿™ä¸ªå·¥å…·å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Starï¼